<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>hangge.com</title>

 <style>
     canvas {
       cursor: pointer;
       border: 1px solid black;
     }
     a {
         position: absolute;
     }
 </style>

    <script>
        window.onload = function() {
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
            context.fillStyle = "green";
            context.fillRect(50, 50, 100, 100);
            // no argument defaults to image/png; image/jpeg, etc also work on some
            var i = canvas.toDataURL("image/png");
            var type = 'png';
            var _fixType = function(type) {
                type = type.toLowerCase().replace(/jpg/i, 'jpeg');
                var r = type.match(/png|jpeg|bmp|gif/)[0];
                return 'image/' + r;
            };

// 加工image data，替换mime type
            var imgData = i.replace(_fixType(type), 'image/octet-stream');
            var d = document.createElement('a');
            d.herf = imgData;
            d.text = "??"
            d.download = ("?");
            document.body.appendChild(d)
        }
    </script>

</head>

<body>
<canvas id=canvas width=200 height=200></canvas>

</body>
</html>
